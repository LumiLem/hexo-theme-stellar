// =============================================
// Ech0 动态时间线样式
// 参考：微信朋友圈、Instagram、Pinterest、小红书
// =============================================

.tag-plugin.timeline.ds-ech0
  padding-left: 16px
  .widget-wrapper &
    padding-left: 0

  
  .timenode 
    position: relative
    &+.timenode
      margin-top: 2rem
      .widget-wrapper &
        margin-top: 1rem
    
    .body
      width: auto
      padding: 0
      background: var(--card)
      border-radius: $border-card
      box-shadow: $boxshadow-card
      overflow: hidden
      border: 1px solid var(--block-border)
      margin-top: 4px
      
      .widget-wrapper &
        margin: 0.25rem var(--gap-padding)
        border-radius: $border-card-s
      
      .content
        padding: 0.75rem 1rem
        font-size: $fs-15
        line-height: 1.6
        .widget-wrapper &
          padding: 0.5rem 0.75rem
          font-size: $fs-14
        p 
          margin: 0
          &:not(:last-child)
            margin-bottom: 0.5rem

      .gallery
        padding: 0 0.75rem 0.5rem
        .widget-wrapper &
          padding: 0 0.5rem 0.5rem
      
      .footer
        padding: 0.5rem 1rem
        display: flex
        flex-wrap: wrap
        justify-content: space-between
        align-items: stretch
        border-top: 1px solid var(--block-border)
        background: transparent
        user-select: none
        .widget-wrapper &
          padding: 0.5rem
        .flex
          display: flex
          flex-wrap: wrap
          gap: 4px
          align-items: stretch
        .item
          border-width: 1px
          border-style: solid
          margin: 2px
          border-radius: 4px
          padding: 0 0.5rem
          .widget-wrapper &
            padding: 0 0.25rem
            margin: 1px
            font-size: $fs-12
          display: flex 
          align-items: center
          font-size: $fs-13
          font-weight: 500
          border-color: var(--block-border)
          background: var(--block)
          color: var(--text-p3)
          trans2 color background border-color
          svg
            width: 1.25em
            height: 1.25em
            margin-right: 2px
            flex-shrink: 0
          .count
            margin-left: 2px
            line-height: 0
          &.like
            cursor: pointer
            &:hover
              background: var(--block-hover)
            &.active
              color: var(--accent)
              border-color: var(--accent)
              background: rgba(128, 128, 128, 0.05)
          &.origin, &.share
            cursor: pointer
            &:hover
              background: var(--block-border)
          &.label
            background: transparent
            border-color: transparent
            color: var(--text-p3)
            padding: 0
            margin-right: 8px
            font-weight: 400

  // =============================================
  // 通用媒体样式
  // =============================================
  .gallery
    img, video
      width: 100%
      border-radius: $border-image
      display: block
      background: var(--block)
      object-fit: cover
      transition: transform 0.2s ease, opacity 0.2s ease
      &:hover
        opacity: 0.92
    
    .image-container,
    .video-container,
    .livephoto-container
      position: relative
      overflow: hidden
      border-radius: $border-image

    .video-container 
      .play-overlay
        position: absolute
        top: 50%
        left: 50%
        transform: translate(-50%, -50%)
        background: rgba(0,0,0,0.55)
        border-radius: 50%
        width: 44px
        height: 44px
        display: flex
        align-items: center
        justify-content: center
        pointer-events: none
        backdrop-filter: blur(4px)
        border: 1.5px solid rgba(255,255,255,0.25)
        svg 
          width: 20px
          height: 20px
          margin-left: 2px

    // Live Photo 样式已由全局 livephoto.styl 提供
    // 结构与文章内页保持一致，此处覆盖 inline-grid 以适配画廊布局
    .livephoto-container
      position: relative
      width: 100%
      border-radius: 6px
      overflow: hidden
      // 覆盖 livephoto.styl 的悬停效果，与普通图片/视频保持一致
      &:hover
        transform: none
        box-shadow: none
      .livephoto-image
        display: block
        width: 100%
        height: auto
        border-radius: $border-image
      .livephoto-video
        position: absolute
        top: 0
        left: 0
        width: 100%
        height: 100%
        object-fit: cover
        opacity: 0
        border-radius: $border-image

  // =============================================
  // 布局一：九宫格 (Grid) - 微信朋友圈/Instagram风格
  // 特点：正方形缩略图，智能列数，视觉整齐
  // =============================================
  .gallery.layout-grid
    display: grid
    gap: 4px
    
    // 默认三列，侧边栏两列
    grid-template-columns: repeat(3, 1fr)
    .widget-wrapper &
      grid-template-columns: repeat(2, 1fr)
      &[data-count="4"]
        grid-template-columns: repeat(2, 1fr)
    
    // 单图：大图展示，保持原始比例
    &[data-count="1"]
      grid-template-columns: 1fr
      .image-container,
      .video-container,
      .livephoto-container
        max-width: 100%
        img, video
          aspect-ratio: auto
          max-height: 400px
          object-fit: contain
          background: transparent
    
    // 双图：两列并排
    &[data-count="2"]
      grid-template-columns: repeat(2, 1fr)
    
    // 四图：田字格
    &[data-count="4"]
      grid-template-columns: repeat(2, 1fr)
    
    // 多图通用：强制正方形并居中裁切
    &:not([data-count="1"])
      .image-container,
      .video-container,
      .livephoto-container
        aspect-ratio: 1
        width: 100%
        overflow: hidden
        display: grid
        img, video, .livephoto-image, .livephoto-video
          width: 100%
          height: 100%
          object-fit: cover
          object-position: center
          grid-area: 1 / 1

  // =============================================
  // 布局二：瀑布流 (Waterfall) - Pinterest/小红书风格
  // 特点：错落有致，保持原图比例，双列布局
  // =============================================
  .gallery.layout-waterfall
    display: block
    column-count: 2
    column-gap: 6px
    .widget-wrapper &
      column-count: 1
    
    .image-container,
    .video-container,
    .livephoto-container
      display: block
      width: 100%
      margin-bottom: 6px
      break-inside: avoid
      
      img, video
        width: 100%
        height: auto
        aspect-ratio: auto
        object-fit: cover

  // =============================================
  // 布局三：横向滚动 (Horizontal) - 抖音/快手/Stories风格
  // 特点：固定高度，横向滑动，触控友好
  // =============================================
  .gallery.layout-horizontal
    display: flex
    overflow-x: auto
    overflow-y: hidden
    gap: 6px
    padding-bottom: 8px
    scroll-behavior: smooth
    -webkit-overflow-scrolling: touch
    
    // 美化滚动条
    scrollbar-width: thin
    scrollbar-color: var(--text-p4) transparent
    &::-webkit-scrollbar
      height: 4px
    &::-webkit-scrollbar-track
      background: transparent
    &::-webkit-scrollbar-thumb
      background: var(--text-p4)
      border-radius: 4px
      &:hover
        background: var(--text-p3)
    
    .image-container,
    .video-container,
    .livephoto-container
      flex: 0 0 auto
      width: 140px
      height: 186px
      border-radius: $border-image
      
      img, video
        width: 100%
        height: 100%
        object-fit: cover
        border-radius: $border-image

  // =============================================
  // 布局四：轮播图 (Carousel) - Ech0 原版风格
  // 特点：一次只显示一张图，通过按钮切换
  // =============================================
  .gallery.layout-carousel
    position: relative
    border-radius: 8px
    overflow: hidden
    
    .carousel-slide
      position: relative
      width: 100%
      
      img, video
        width: 100%
        height: auto
        display: block
        border-radius: $border-image
    
    // 隐藏非当前项
    .image-container,
    .video-container,
    .livephoto-container
      display: none
      &.active
        display: block
  
  .carousel-nav
    display: flex
    align-items: center
    justify-content: center
    gap: 12px
    margin-top: 12px
    color: var(--text-p3)
    
    .nav-btn
      display: flex
      align-items: center
      justify-content: center
      width: 32px
      height: 32px
      border-radius: 50%
      border: 1px solid var(--block-border)
      background: var(--card)
      color: var(--text-p2)
      cursor: pointer
      transition: all 0.2s ease
      &:hover:not(:disabled)
        background: var(--block-hover)
        color: var(--accent)
        border-color: var(--accent)
      &:disabled
        opacity: 0.4
        cursor: not-allowed
      svg
        width: 16px
        height: 16px
        fill: currentColor
    
    .carousel-counter
      font-size: $fs-13
      min-width: 60px
      text-align: center

  // =============================================
  // 扩展内容样式
  // =============================================
  .tag-plugin.audio-player
    padding: 0.5rem 1rem
  
  .tag-plugin.video-player
    margin: 0.5rem 0.75rem
    border-radius: 8px
    overflow: hidden
    background: #000
    iframe, video 
      display: block
      width: 100%
      height: 100%
      border: none

  .tag-plugin.link
    margin: 0.5rem 1rem

  // =============================================
  // 加载更多按钮
  // =============================================
  .load-more
    display: flex
    align-items: center
    gap: 6px
    padding: 0.5rem 1.5rem
    border-radius: $border-button
    font-size: $fs-14
    font-weight: 500
    margin: 2rem auto
    width: fit-content
    background: var(--block)
    color: var(--text-p2)
    cursor: pointer
    user-select: none
    trans2 color background
    svg
      width: 1.1em
      height: 1.1em
      color: var(--text-p4)
      trans1 color
      &.loading
        animation: spin 1s linear infinite
    &:hover
      background: var(--theme-a20)
      color: var(--theme)
      svg
        color: var(--theme)
    &:active
      opacity: 0.8

@keyframes spin
  from
    transform: rotate(0deg)
  to
    transform: rotate(360deg)
