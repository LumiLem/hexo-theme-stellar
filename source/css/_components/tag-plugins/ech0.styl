// =============================================
// Ech0 动态时间线样式
// 参考：微信朋友圈、Instagram、Pinterest、小红书
// =============================================

.tag-plugin.timeline.ds-ech0
  padding-left: 0
  &:before
    display: none
  
  .timenode 
    padding-left: 16px
    &:before
      content: ''
      position: absolute
      z-index: 0
      background: var(--block)
      width: 4px
      left: 0px
      border-radius: 8px
      top: 0.5rem
      bottom: 0
    &+.timenode
      margin-top: 2rem
    
    .body
      padding: 0
      background: var(--card)
      border-radius: 12px
      box-shadow: $boxshadow-card
      overflow: hidden
      border: 1px solid var(--block-border)
      
      .content
        padding: 0.75rem 1rem
        font-size: $fs-15
        line-height: 1.6
        p 
          margin: 0
          &:not(:last-child)
            margin-bottom: 0.5rem

      .gallery
        padding: 0 0.75rem 0.5rem
      
      .footer
        padding: 0.5rem 1rem
        border-top: 1px solid var(--block-border)
        background: var(--block)
        .flex
          gap: 8px
        .item
          border-radius: 6px
          font-size: $fs-12
          padding: 2px 8px
          background: var(--card)
          border: 1px solid var(--block-border)
          trans1 all
          &.like
            cursor: pointer
            &:hover
              background: var(--block-hover)
            &.active
              color: var(--accent)
              border-color: var(--accent)
              background: rgba(128, 128, 128, 0.05)
          &.origin
            color: var(--text-p3)
            &:hover
              color: var(--accent)
              border-color: var(--accent)

  // =============================================
  // 通用媒体样式
  // =============================================
  .gallery
    img, video
      width: 100%
      border-radius: 6px
      display: block
      background: var(--block)
      object-fit: cover
      transition: transform 0.2s ease, opacity 0.2s ease
      &:hover
        opacity: 0.92
    
    .image-container,
    .video-container,
    .livephoto-container
      position: relative
      overflow: hidden
      border-radius: 6px
      background: var(--block)

    .video-container 
      .play-overlay
        position: absolute
        top: 50%
        left: 50%
        transform: translate(-50%, -50%)
        background: rgba(0,0,0,0.55)
        border-radius: 50%
        width: 44px
        height: 44px
        display: flex
        align-items: center
        justify-content: center
        pointer-events: none
        backdrop-filter: blur(4px)
        border: 1.5px solid rgba(255,255,255,0.25)
        svg 
          width: 20px
          height: 20px
          margin-left: 2px

    // Live Photo 样式已由全局 livephoto.styl 提供
    // 结构与文章内页保持一致，此处覆盖 inline-grid 以适配画廊布局
    .livephoto-container
      display: block  // 覆盖 livephoto.styl 的 inline-grid
      position: relative
      width: 100%
      border-radius: 6px
      overflow: hidden
      .livephoto-image
        display: block
        width: 100%
        height: auto
        border-radius: 6px
      .livephoto-video
        position: absolute
        top: 0
        left: 0
        width: 100%
        height: 100%
        object-fit: cover
        opacity: 0
        border-radius: 6px

  // =============================================
  // 布局一：九宫格 (Grid) - 微信朋友圈/Instagram风格
  // 特点：正方形缩略图，智能列数，视觉整齐
  // =============================================
  .gallery.layout-grid
    display: grid
    gap: 4px
    
    // 默认三列
    grid-template-columns: repeat(3, 1fr)
    
    // 单图：大图展示，保持原始比例
    &[data-count="1"]
      grid-template-columns: 1fr
      .image-container,
      .video-container,
      .livephoto-container
        max-width: 100%
        img, video
          aspect-ratio: auto
          max-height: 400px
          object-fit: contain
          background: transparent
    
    // 双图：两列并排
    &[data-count="2"]
      grid-template-columns: repeat(2, 1fr)
    
    // 四图：田字格
    &[data-count="4"]
      grid-template-columns: repeat(2, 1fr)
    
    // 多图通用：强制正方形
    &:not([data-count="1"])
      .image-container,
      .video-container,
      .livephoto-container
        aspect-ratio: 1
        img, video
          width: 100%
          height: 100%
          object-fit: cover

  // =============================================
  // 布局二：瀑布流 (Waterfall) - Pinterest/小红书风格
  // 特点：错落有致，保持原图比例，双列布局
  // =============================================
  .gallery.layout-waterfall
    display: block
    column-count: 2
    column-gap: 6px
    
    .image-container,
    .video-container,
    .livephoto-container
      display: block
      width: 100%
      margin-bottom: 6px
      break-inside: avoid
      
      img, video
        width: 100%
        height: auto
        aspect-ratio: auto
        object-fit: cover

  // =============================================
  // 布局三：横向滚动 (Horizontal) - 抖音/快手/Stories风格
  // 特点：固定高度，横向滑动，触控友好
  // =============================================
  .gallery.layout-horizontal
    display: flex
    overflow-x: auto
    overflow-y: hidden
    gap: 6px
    padding-bottom: 6px
    scroll-behavior: smooth
    -webkit-overflow-scrolling: touch
    
    // 隐藏滚动条但保持功能
    scrollbar-width: none
    &::-webkit-scrollbar
      display: none
    
    .image-container,
    .video-container,
    .livephoto-container
      flex: 0 0 auto
      width: 140px
      height: 186px
      border-radius: 8px
      
      img, video
        width: 100%
        height: 100%
        object-fit: cover
        border-radius: 8px

  // =============================================
  // 布局四：轮播图 (Carousel) - 微博/Facebook风格
  // 特点：全宽展示，滑动切换，沉浸体验
  // =============================================
  .gallery.layout-carousel
    display: flex
    overflow-x: auto
    overflow-y: hidden
    scroll-snap-type: x mandatory
    scroll-behavior: smooth
    -webkit-overflow-scrolling: touch
    border-radius: 8px
    background: #000
    
    // 隐藏滚动条
    scrollbar-width: none
    &::-webkit-scrollbar
      display: none
    
    .image-container,
    .video-container,
    .livephoto-container
      flex: 0 0 100%
      scroll-snap-align: start
      scroll-snap-stop: always
      aspect-ratio: 4/3
      background: #000
      
      img, video
        width: 100%
        height: 100%
        object-fit: contain
        border-radius: 0
        background: #000

  // =============================================
  // 扩展内容样式
  // =============================================
  .tag-plugin.audio-player
    padding: 0.5rem 1rem
  
  .tag-plugin.link
    margin: 0.5rem 1rem

  // =============================================
  // 加载更多按钮
  // =============================================
  .load-more
    padding: 0.6rem 2rem
    border-radius: 20px
    font-size: $fs-13
    font-weight: 500
    margin: 2rem auto
    width: fit-content
    background: var(--card)
    border: 1px solid var(--block-border)
    color: var(--text-p2)
    box-shadow: $boxshadow-card
    cursor: pointer
    user-select: none
    trans1 all
    &:hover
      background: var(--accent)
      color: white
      border-color: var(--accent)
      transform: translateY(-2px)
      box-shadow: $boxshadow-card-float
    &:active
      transform: translateY(0)
